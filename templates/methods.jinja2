{# =============================================================================
   ARG Phylogenomics â€” Methods Paragraph Template
   Auto-generates a Methods section suitable for academic manuscripts.
   ============================================================================= #}
## Methods

Antibiotic resistance gene (ARG) sequences for {{ organism }} were retrieved from NCBI GenBank using Entrez queries targeting {{ n_genes }} genes ({{ gene_list }}). A maximum of {{ max_records }} coding sequences (CDS) per gene were downloaded with associated metadata (accession, country of isolation, collection date). Near-identical sequences were clustered at {{ clustering_identity }}% identity using CD-HIT-EST v{{ versions.cdhit }} to reduce redundancy. Quality filtering removed sequences shorter than {{ min_len }} nt, those with >{{ max_ambig }}% ambiguous bases, out-of-frame sequences, and those containing premature internal stop codons.

Protein-guided codon alignments were generated by translating nucleotide sequences, aligning protein sequences with MAFFT v{{ versions.mafft }} (--auto mode), and back-translating to codon-aware nucleotide alignments. Poorly aligned regions were trimmed using TrimAl v{{ versions.trimal }} (-automated1). Substitution saturation was assessed using Xia's test at each codon position.

Maximum-likelihood phylogenetic trees were inferred using IQ-TREE2 v{{ versions.iqtree }} with automatic model selection (ModelFinder Plus), {{ bootstrap }} ultrafast bootstrap replicates, and {{ alrt }} SH-aLRT replicates. Trees were rooted using {{ rooting_method }} rooting.

Recombination breakpoints were detected using GARD (Genetic Algorithm for Recombination Detection) implemented in HyPhy v{{ versions.hyphy }}. {% if recombination_aware %}Alignments were partitioned at detected breakpoints, and subsequent selection analyses were performed per partition to avoid false positives due to recombination.{% endif %}

Natural selection was assessed using seven methods in HyPhy v{{ versions.hyphy }} under the Bacterial and Plant Plastid genetic code (NCBI Code 11): SLAC, FEL, MEME, FUBAR, BUSTED, aBSREL, and RELAX. Significance thresholds were set at p < {{ p_thresh }} for frequentist methods and posterior probability > 0.9 for FUBAR. P-values were corrected for multiple testing using the {{ correction_method }} method.

Horizontal gene transfer (HGT) was inferred through phylogenetic incongruence analysis comparing gene trees against a species reference tree constructed from concatenated housekeeping genes ({{ housekeeping_list }}). Robinson-Foulds topological distance and the Approximately Unbiased (AU) test were used to quantify incongruence. Parametric evidence was assessed via GC content deviation and Codon Adaptation Index (CAI) analysis.

{% if domains_enabled %}Protein domains were annotated using hmmscan (HMMER v{{ versions.hmmer }}) against the Pfam-A database. Selected sites were mapped onto domain architectures to identify functional regions under selection.{% endif %}

{% if variant_naming %}Sequences were classified to known variant types by BLAST against the Comprehensive Antibiotic Resistance Database (CARD).{% endif %}

All analyses were orchestrated using Nextflow v{{ versions.nextflow }} (DSL2) for reproducibility and parallel execution.
