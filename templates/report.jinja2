{# =============================================================================
   ARG Phylogenomics — Per-Gene Report Template
   ============================================================================= #}
# {{ gene }} — Analysis Report

**Organism**: {{ organism }}
**Pipeline**: ARG Phylogenomics Toolkit v{{ version }}
**Date**: {{ date }}

---

## 1. Data Summary

| Metric | Value |
|--------|-------|
| Raw sequences fetched | {{ n_raw }} |
| After CD-HIT (99%) | {{ n_clustered }} |
| After QC filtering | {{ n_clean }} |
| Alignment length (nt) | {{ aln_length }} |
| Alignment length after trimming | {{ aln_trimmed_length }} |
| Gap percentage | {{ gap_pct }}% |
| Informative sites | {{ informative_sites }} |

{% if variant_names %}
## 2. Variant Classification (CARD)

| Accession | Variant | Identity |
|-----------|---------|----------|
{% for v in variant_names %}
| {{ v.accession }} | {{ v.variant }} | {{ v.identity }}% |
{% endfor %}
{% endif %}

## 3. Substitution Saturation

- Xia's Iss statistic: **{{ iss_value }}**
- Critical Iss: **{{ iss_critical }}**
- Status: **{{ saturation_status }}** {% if saturation_status == "SATURATED" %}⚠️{% else %}✅{% endif %}

## 4. Phylogenetic Tree

- Model selected: **{{ tree_model }}**
- Log-likelihood: **{{ tree_lnl }}**
- Nodes with UFBoot ≥ 70%: **{{ pct_supported }}%**
- Rooting method: **{{ rooting_method }}**

## 5. Recombination (GARD)

- Breakpoints detected: **{{ gard_breakpoints }}**
{% if gard_breakpoints > 0 %}
- Partition positions: {{ gard_positions }}
{% endif %}

## 6. Selection Analysis

> Genetic code: **Bacterial and Plant Plastid** (Code 11)
> Multiple testing correction: **{{ correction_method }}**

### Gene-wide (BUSTED)

- p-value: **{{ busted_p }}** {% if busted_p and busted_p < p_thresh %}→ **Evidence of positive selection** ✅{% endif %}

### Site-level

| Method | Positive sites | Negative sites |
|--------|:---------:|:---------:|
| SLAC (p<{{ p_thresh }}) | {{ slac_pos }} | {{ slac_neg }} |
| FEL (q<{{ q_thresh }}) | {{ fel_pos }} | {{ fel_neg }} |
| MEME (p<{{ p_thresh }}) | {{ meme_pos }} | — |
| FUBAR (PP>0.9) | {{ fubar_pos }} | {{ fubar_neg }} |

### Branch-level

- aBSREL: **{{ absrel_branches }}** branches under episodic selection
- RELAX: Selection intensity K = **{{ relax_k }}** (p = {{ relax_p }})

## 7. HGT Evidence

| Metric | Value | Interpretation |
|--------|-------|----------------|
| RF distance (vs species tree) | {{ rf_distance }} | {{ rf_interpretation }} |
| AU test p-value | {{ au_pvalue }} | {{ au_interpretation }} |
| GC content (gene) | {{ gc_gene }}% | {{ gc_interpretation }} |
| CAI score | {{ cai_score }} | {{ cai_interpretation }} |
| **Overall HGT evidence** | **{{ hgt_verdict }}** | |

{% if domains %}
## 8. Domain Architecture

{% for d in domains %}
- **{{ d.name }}** ({{ d.accession }}): positions {{ d.start }}–{{ d.end }} — {{ d.description }}
{% endfor %}

### Selection Site Overlay

![Domain-selection overlay](../figures/{{ gene }}_domain_overlay.png)

[Interactive version →](../figures/{{ gene }}_domain_overlay.html)
{% endif %}

{% if temporal_signal %}
## 9. Temporal Signal

- Root-to-tip R² = **{{ temporal_r2 }}**
- Slope = **{{ temporal_slope }}** substitutions/site/year
- Date range: {{ temporal_date_range }}
{% endif %}

---

*Report generated by ARG Phylogenomics Toolkit v{{ version }}*
